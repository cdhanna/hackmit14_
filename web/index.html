<!DOCTYPE html>
<html>

    <head>
    	<title> Delicious DFA </title>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>


		<script src="nfa.js"></script>
		<script src="edit.js"></script>
		<script src="visual.js"></script>
        <script src="stepping.js"></script>
		
		<link rel="stylesheet" type="text/css" href="style.css">
    	
    </head>
    
    
    <body>
    
		<h1 id='title'> Delicious DFA </h1>


        <form id='regexform'>
            Enter a valid regular expression: <input type="text" id="regexinp">
            <button type="button" id="regexbutton">Generate NFA</button><br>
            Enter a string to test: <input type="text" id="textinp">
            <button type="button" id="testbutton">Test</button>
        </form>

    	<canvas id='canvas' width='900px' height='600px'>
    		Browser is not supported
    	</canvas>

    	<script>
    		$(document).ready(function() { 
			
    			//get data from html
    			var canvas = document.getElementById('canvas');
    			var editor = new Editor();

                var scale = {x:1, y: 1};
                var offset = {x: 0, y: 0};

    			//get the mouse position on the canvas 
    			function getMousePos( evt){
    				var rect = canvas.getBoundingClientRect();
    				var m= {x:evt.clientX - rect.left, y:evt.clientY - rect.top};
                    
                    m.x -= offset.x;
                    m.y -= offset.y;

                    m.x /= scale.x;
                    m.y /= scale.y;

                    

                    return m;
    			}

    			$('#canvas').on('mousedown', function(e){
    				
    				var mousePos = getMousePos(e);
    				editor.onMouseDown(mousePos);
    			});

    			$('#canvas').on('mouseup', function(e){
    				var mousePos = getMousePos(e);
    				editor.onMouseUp(mousePos);
    			});

                $('#canvas').on('mousemove', function(e){
                    var mousePos = getMousePos(e);
                    editor.update(mousePos);

                });


                $(document).on('keydown', function(e){

                    editor.onKey(e);
                });

                $('#canvas').on('mousewheel', function(e){
                    
                    var delta = (e.originalEvent.wheelDelta/120);
                    delta *= .05;
                    scale.x += delta;
                    scale.y += delta;
                    if (scale.x < .2) scale.x = .2;
                    if (scale.y < .2) scale.y = .2;

                    var rect = canvas.getBoundingClientRect();
                    var m= {x:e.clientX - rect.left, y:e.clientY - rect.top};
                    // m.x /= scale.x;
                    // m.y /= scale.y;
                    offset = m;
                });

                $('#regexbutton').on('click', function(e){
                    editor.generateFrom(document.getElementById('regexinp').value);
                });

                $('#testbutton').on('click', function(e){
                    var text = document.getElementById('textinp').value;
                    var active = new traverse_now(text, editor.nfa).newactivestates;
                    editor.vs.setActiveNodes(active);
                });

    			 function update(){
                    editor.draw(canvas, scale, offset);
                    editor.updateNormal();
    			 }


                 editor.generateFrom("b");

				setInterval(update, 10);
    		});
    	</script>

        <div style="position:fixed; bottom:-5; text-align:center;">
            <img src="untitled.png" alt="" />
        </div>

    </body>

</html>